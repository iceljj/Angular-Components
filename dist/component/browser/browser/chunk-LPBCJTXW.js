import{i as w,j as U,k,o as E}from"./chunk-3BOVJI26.js";import{Gc as h,Sb as p,Tb as o,Ub as r,Vb as M,ac as m,cb as v,fc as u,gb as l,hc as d,ra as g,rc as P,sa as _,sb as b,sc as C,vc as s,wc as x,xc as O,yb as f}from"./chunk-SV3L42UN.js";import"./chunk-IJBWTILK.js";var F=i=>({"grid-view":i});function I(i,e){if(i&1&&(o(0,"div",21),M(1,"img",22),r()),i&2){let t=d().$implicit,n=d();l(),p("src",n.getFilePreview(t.file),v)}}function S(i,e){if(i&1&&(o(0,"div",23)(1,"div",24)(2,"span",25),s(3),r()()()),i&2){let t=d().$implicit;l(),P("width",t.progress,"%"),l(2),O("",t.progress,"%")}}function D(i,e){if(i&1){let t=m();o(0,"button",7),u("click",function(){g(t);let a=d().index,c=d();return _(c.pauseUpload(a))}),s(1,"\u6682\u505C"),r()}}function T(i,e){if(i&1){let t=m();o(0,"button",7),u("click",function(){g(t);let a=d().index,c=d();return _(c.resumeUpload(a))}),s(1,"\u7EE7\u7EED"),r()}}function V(i,e){if(i&1){let t=m();o(0,"button",26),u("click",function(){g(t);let a=d().index,c=d();return _(c.cancelUpload(a))}),s(1,"\u53D6\u6D88"),r()}}function N(i,e){if(i&1){let t=m();o(0,"div",12),f(1,I,2,1,"div",13),o(2,"div",14)(3,"span"),s(4),r(),o(5,"span",15),s(6),r()(),f(7,S,4,3,"div",16),o(8,"div",17),f(9,D,2,0,"button",18)(10,T,2,0,"button",18)(11,V,2,0,"button",19),o(12,"button",20),u("click",function(){let a=g(t).index,c=d();return _(c.deleteFile(a))}),s(13,"\u5220\u9664"),r()()()}if(i&2){let t=e.$implicit,n=d();l(),p("ngIf",n.getFilePreview(t.file)),l(3),x(t.file.name),l(2),x(n.getFileStatusText(t.status)),l(),p("ngIf",t.status!=="success"&&t.status!=="failed"),l(2),p("ngIf",t.status==="uploading"),l(),p("ngIf",t.status==="paused"),l(),p("ngIf",t.status==="uploading")}}var y=class i{currentView="list";setView(e){this.currentView=e}files=[];uploadingQueue=[];MAX_CONCURRENT_UPLOADS=3;MAX_FILE_SIZE=5*1024*1024;isDragging=!1;onDragOver(e){e.preventDefault(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),this.isDragging=!1}onDrop(e){e.preventDefault(),this.isDragging=!1;let t=e.dataTransfer?.files;t&&t.length>0&&this.handleFiles(t)}onFileSelected(e){let t=e.target;t.files&&t.files.length>0&&this.handleFiles(t.files)}handleFiles(e){for(let t=0;t<e.length;t++){let n=e[t];n.size<=this.MAX_FILE_SIZE?this.files.push({file:n,progress:0,status:"pending",retryCount:0,maxRetries:3}):alert(`\u6587\u4EF6 "${n.name}" \u8D85\u8FC7\u6700\u5927\u9650\u5236 5MB\uFF0C\u5DF2\u88AB\u5FFD\u7565`)}this.startNextBatch()}startNextBatch(){let e=this.files.filter(n=>n.status==="pending"),t=Math.min(this.MAX_CONCURRENT_UPLOADS-this.uploadingCount(),e.length);for(let n=0;n<t;n++){let a=e[n];a&&(a.status="uploading",this.uploadSingle(a))}}uploadingCount(){return this.files.filter(e=>e.status==="uploading").length}uploadSingle(e){let t=e.progress,n=setInterval(()=>{if(e.status!=="uploading"){clearInterval(n);return}t+=Math.floor(Math.random()*5)+5,t>=100?(clearInterval(n),Math.random()>.1?(e.progress=100,e.status="success"):(e.retryCount++,e.retryCount<e.maxRetries?setTimeout(()=>{e.status="pending",this.startNextBatch()},1e3):e.status="failed"),this.startNextBatch()):e.progress=t},200);e.intervalId=n}pauseUpload(e){let t=this.files[e];t.status==="uploading"&&t.intervalId&&(clearInterval(t.intervalId),t.status="paused")}resumeUpload(e){let t=this.files[e];t.status==="paused"&&(t.status="uploading",this.uploadSingle(t))}cancelUpload(e){let t=this.files[e];t.status==="uploading"&&t.intervalId&&(clearInterval(t.intervalId),t.status="canceled",t.progress=0)}deleteFile(e){this.files.splice(e,1)}cancelAll(){this.files.forEach(e=>{e.status==="uploading"&&e.intervalId&&clearInterval(e.intervalId),e.status="canceled",e.progress=0}),this.files=this.files.filter(e=>e.status!=="canceled")}allUploaded(){return this.files.every(e=>e.status==="success")}noneUploading(){return!this.files.some(e=>e.status==="uploading")}getFileStatusText(e){switch(e){case"pending":return"\u7B49\u5F85\u4E0A\u4F20";case"uploading":return"\u4E0A\u4F20\u4E2D...";case"paused":return"\u5DF2\u6682\u505C";case"success":return"\u4E0A\u4F20\u6210\u529F";case"failed":return"\u4E0A\u4F20\u5931\u8D25";case"canceled":return"\u5DF2\u53D6\u6D88";default:return""}}getFilePreview(e){return e.type.startsWith("image/")?URL.createObjectURL(e):null}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=b({type:i,selectors:[["app-comp-upload"]],hostBindings:function(t,n){t&1&&u("dragover",function(c){return n.onDragOver(c)})("dragleave",function(c){return n.onDragLeave(c)})("drop",function(c){return n.onDrop(c)})},decls:20,vars:11,consts:[[1,"upload-container"],[1,"upload-zone"],[1,"custom-file-upload"],["type","file","multiple","",3,"change"],[1,"file-input-label"],[1,"file-input-icon"],[1,"view-toggle"],[3,"click"],[1,"file-list-scroll",3,"ngClass"],["class","file-item",4,"ngFor","ngForOf"],[1,"global-actions"],[3,"click","disabled"],[1,"file-item"],["class","preview",4,"ngIf"],[1,"file-info"],[1,"status"],["class","progress-wrapper",4,"ngIf"],[1,"actions"],[3,"click",4,"ngIf"],["class","cancel-btn",3,"click",4,"ngIf"],[1,"delete-btn",3,"click"],[1,"preview"],["alt","\u9884\u89C8\u56FE",3,"src"],[1,"progress-wrapper"],[1,"progress-bar"],[1,"progress-text"],[1,"cancel-btn",3,"click"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"p"),s(3,"\u5C06\u6587\u4EF6\u62D6\u653E\u5230\u6B64\u5904\u4E0A\u4F20"),r(),o(4,"label",2)(5,"input",3),u("change",function(c){return n.onFileSelected(c)}),r(),o(6,"span",4),s(7,"\u9009\u62E9\u6587\u4EF6"),r(),o(8,"span",5),s(9,"\u{1F4C1}"),r()()(),o(10,"div",6)(11,"button",7),u("click",function(){return n.setView("list")}),s(12,"\u5217\u8868\u89C6\u56FE"),r(),o(13,"button",7),u("click",function(){return n.setView("grid")}),s(14,"\u7F51\u683C\u89C6\u56FE"),r()(),o(15,"div",8),f(16,N,14,7,"div",9),r(),o(17,"div",10)(18,"button",11),u("click",function(){return n.cancelAll()}),s(19,"\u53D6\u6D88\u5168\u90E8"),r()()()),t&2&&(C("dragging",n.isDragging),l(11),C("active",n.currentView==="list"),l(2),C("active",n.currentView==="grid"),l(2),p("ngClass",h(9,F,n.currentView==="grid")),l(),p("ngForOf",n.files),l(2),p("disabled",n.noneUploading()))},dependencies:[E,w,U,k],styles:['@charset "UTF-8";.upload-container[_ngcontent-%COMP%]{padding:20px;border:2px dashed #ccc;border-radius:8px;background-color:#f9f9f9;transition:background-color .3s ease;text-align:center}.upload-container.dragging[_ngcontent-%COMP%]{background-color:#e0f7fa;border-color:#00bcd4}.upload-container[_ngcontent-%COMP%]   .upload-zone[_ngcontent-%COMP%]{margin-bottom:20px}.upload-container[_ngcontent-%COMP%]   .upload-zone[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px;color:#666}.upload-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:10px 20px;background:linear-gradient(135deg,#4a90e2,#76c7c0);color:#fff;border-radius:6px;cursor:pointer;font-weight:700;transition:all .3s ease;box-shadow:0 2px 5px #0003}.upload-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0003}.upload-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.upload-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]   .file-input-icon[_ngcontent-%COMP%]{margin-left:8px;font-size:18px}.upload-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]   .file-input-label[_ngcontent-%COMP%]{transition:all .3s ease}.upload-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]:hover   .file-input-label[_ngcontent-%COMP%]{letter-spacing:.5px}.upload-container[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]{margin:10px 0;display:flex;justify-content:center;gap:10px}.upload-container[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border:none;border-radius:4px;background-color:#ddd;color:#333;cursor:pointer;transition:background-color .3s}.upload-container[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#4a90e2;color:#fff}.upload-container[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#bbb}.upload-container[_ngcontent-%COMP%]   .file-list-scroll[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;margin-top:10px;display:flex;flex-direction:column;gap:10px}.upload-container[_ngcontent-%COMP%]   .file-list-scroll.grid-view[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;justify-content:flex-start}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;border-bottom:1px solid #ddd;padding:15px 0;background-color:#fff;border-radius:6px;transition:background-color .3s}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.upload-container[_ngcontent-%COMP%]   .file-item.grid-view[_ngcontent-%COMP%]{width:calc(33% - 10px);min-width:200px;flex-direction:column;align-items:center;padding:10px;text-align:center}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]{width:60px;height:60px;overflow:hidden;border-radius:4px}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{font-weight:700;color:#555}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .progress-wrapper[_ngcontent-%COMP%]{width:100%;height:10px;background-color:#f0f0f0;border-radius:5px;overflow:hidden}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{height:100%;width:0;background:linear-gradient(90deg,#4a90e2,#76c7c0);position:relative;transition:width .3s ease}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{position:absolute;right:5px;top:50%;transform:translateY(-50%);font-size:10px;color:#fff}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:flex-end}.upload-container[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;border:none;border-radius:4px;cursor:pointer;font-size:12px;transition:background-color .3s ease}.upload-container[_ngcontent-%COMP%]   .global-actions[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:center}.upload-container[_ngcontent-%COMP%]   .global-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;font-size:14px;cursor:pointer;background-color:#e74c3c;color:#fff;transition:background-color .3s ease}.upload-container[_ngcontent-%COMP%]   .global-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#c0392b}.upload-container[_ngcontent-%COMP%]   .global-actions[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{background-color:#ccc;cursor:not-allowed}.cancel-btn[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#d3840e}.delete-btn[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.delete-btn[_ngcontent-%COMP%]:hover{background-color:#c0392b}@media (max-width: 768px){.file-list-scroll.grid-view[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]{width:calc(50% - 10px)}}@media (max-width: 480px){.file-list-scroll.grid-view[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]{width:100%}}']})};export{y as CompUpload};
