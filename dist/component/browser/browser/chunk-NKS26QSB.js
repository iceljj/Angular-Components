import{t as D}from"./chunk-LM5MDKJD.js";import{k as z,o as I}from"./chunk-3BOVJI26.js";import{Jc as T,Kc as B,Sb as g,Tb as r,Ub as o,Vb as s,Zb as C,_b as b,ac as f,cb as S,fc as p,gb as m,hc as l,lc as E,mc as w,nc as F,ra as d,sa as u,sb as R,vb as A,vc as a,wc as V,yb as M}from"./chunk-SV3L42UN.js";import{j as v}from"./chunk-IJBWTILK.js";var x=class c{transform(t){let e=Math.floor(t/60),n=t%60;return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}static \u0275fac=function(e){return new(e||c)};static \u0275pipe=A({name:"timeFormat",type:c,pure:!0})};var q=["audioVisualizer"],Q=["audioPlayer"];function j(c,t){if(c&1){let e=f();C(0),r(1,"button",11),p("click",function(){d(e);let i=l();return u(i.startRecording())}),s(2,"i",12),a(3," \u5F00\u59CB\u5F55\u97F3 "),o(),b()}}function N(c,t){if(c&1){let e=f();C(0),r(1,"button",13),p("click",function(){d(e);let i=l();return u(i.pauseRecording())}),s(2,"i",14),a(3," \u6682\u505C "),o(),r(4,"button",15),p("click",function(){d(e);let i=l();return u(i.stopRecording())}),s(5,"i",16),a(6," \u505C\u6B62 "),o(),b()}}function $(c,t){if(c&1){let e=f();C(0),r(1,"button",17),p("click",function(){d(e);let i=l();return u(i.resumeRecording())}),s(2,"i",18),a(3," \u7EE7\u7EED "),o(),r(4,"button",15),p("click",function(){d(e);let i=l();return u(i.stopRecording())}),s(5,"i",16),a(6," \u505C\u6B62 "),o(),b()}}function H(c,t){if(c&1){let e=f();r(0,"div",19)(1,"h2"),a(2,"\u5F55\u97F3\u56DE\u653E"),o(),s(3,"audio",20,1),r(5,"button",21),p("click",function(){d(e);let i=l();return u(i.downloadRecording())}),s(6,"i",22),a(7," \u4E0B\u8F7D\u5F55\u97F3 "),o()()}if(c&2){let e=l();m(3),g("src",e.audioUrl,S)}}var U=class c{audioVisualizer;audioPlayer;mediaRecorder=null;audioChunks=[];audioContext=null;analyser=null;dataArray=null;animationFrameId=null;recordingState="idle";audioUrl=null;audioBlob=null;recordingTime=0;timer=null;constructor(){}ngOnInit(){this.checkMicrophonePermission()}ngOnDestroy(){this.stopAudioContext(),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.timer&&clearInterval(this.timer)}checkMicrophonePermission(){return v(this,null,function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop())}catch(t){console.error("\u9EA6\u514B\u98CE\u6743\u9650\u88AB\u62D2\u7EDD:",t),alert("\u8BF7\u6388\u4E88\u9EA6\u514B\u98CE\u6743\u9650\u4EE5\u4F7F\u7528\u5F55\u97F3\u529F\u80FD")}})}startRecording(){return v(this,null,function*(){try{let t=yield navigator.mediaDevices.getUserMedia({audio:!0});this.audioChunks=[],this.recordingState="recording",this.recordingTime=0,this.mediaRecorder=new MediaRecorder(t),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.audioChunks.push(e.data)},this.mediaRecorder.onstop=()=>{this.audioBlob=new Blob(this.audioChunks,{type:"audio/webm"}),this.audioUrl=URL.createObjectURL(this.audioBlob),t.getTracks().forEach(e=>e.stop()),this.recordingState="idle"},this.mediaRecorder.start(100),this.startTimer(),this.initAudioVisualizer(t)}catch(t){console.error("\u5F00\u59CB\u5F55\u97F3\u5931\u8D25:",t),alert("\u65E0\u6CD5\u5F00\u59CB\u5F55\u97F3\uFF0C\u8BF7\u68C0\u67E5\u9EA6\u514B\u98CE\u6743\u9650")}})}pauseRecording(){this.mediaRecorder&&this.recordingState==="recording"&&(this.mediaRecorder.pause(),this.recordingState="paused",this.stopTimer(),this.stopAudioVisualization())}resumeRecording(){this.mediaRecorder&&this.recordingState==="paused"&&(this.mediaRecorder.resume(),this.recordingState="recording",this.startTimer(),this.startAudioVisualization())}stopRecording(){this.mediaRecorder&&this.recordingState!=="idle"&&(this.mediaRecorder.stop(),this.recordingState="idle",this.stopTimer(),this.stopAudioVisualization())}startTimer(){this.stopTimer(),this.timer=setInterval(()=>{this.recordingTime++},1e3)}stopTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}initAudioVisualizer(t){this.stopAudioContext(),this.audioContext=new AudioContext;let e=this.audioContext.createMediaStreamSource(t);this.analyser=this.audioContext.createAnalyser(),e.connect(this.analyser),this.analyser.fftSize=256;let n=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(n),this.startAudioVisualization()}startAudioVisualization(){if(!this.analyser||!this.dataArray)return;let t=this.audioVisualizer.nativeElement,e=t.getContext("2d");if(!e)return;let n=t.width,i=t.height,P=()=>{this.animationFrameId=requestAnimationFrame(P);let h=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(h),e.fillStyle="rgba(0, 0, 0, 0.1)",e.fillRect(0,0,n,i);let O=n/h.length*2.5,_,k=0;for(let y=0;y<h.length;y++)_=h[y]/2,e.fillStyle=`rgb(${_+100}, 50, 150)`,e.fillRect(k,i-_,O,_),k+=O+1};P()}stopAudioVisualization(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null);let t=this.audioVisualizer.nativeElement,e=t.getContext("2d");e&&e.clearRect(0,0,t.width,t.height)}stopAudioContext(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}downloadRecording(){if(!this.audioBlob)return;let t=URL.createObjectURL(this.audioBlob),e=document.createElement("a");e.style.display="none",e.href=t,e.download=`recording-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.webm`,document.body.appendChild(e),e.click(),window.setTimeout(()=>{document.body.removeChild(e),window.URL.revokeObjectURL(t)},100)}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=R({type:c,selectors:[["app-microphone"]],viewQuery:function(e,n){if(e&1&&(E(q,5),E(Q,5)),e&2){let i;w(i=F())&&(n.audioVisualizer=i.first),w(i=F())&&(n.audioPlayer=i.first)}},decls:29,vars:7,consts:[["audioVisualizer",""],["audioPlayer",""],[1,"recorder-container"],[1,"visualizer-container"],["width","600","height","150"],[1,"recording-time"],[1,"controls"],[4,"ngIf"],["class","playback-section",4,"ngIf"],[1,"instructions"],[1,"note"],[1,"control-btn","start-btn",3,"click"],[1,"fas","fa-microphone"],[1,"control-btn","pause-btn",3,"click"],[1,"fas","fa-pause"],[1,"control-btn","stop-btn",3,"click"],[1,"fas","fa-stop"],[1,"control-btn","resume-btn",3,"click"],[1,"fas","fa-play"],[1,"playback-section"],["controls","",3,"src"],[1,"download-btn",3,"click"],[1,"fas","fa-download"]],template:function(e,n){e&1&&(r(0,"div",2)(1,"h1"),a(2,"Angular\u5F55\u97F3\u5E94\u7528"),o(),r(3,"div",3),s(4,"canvas",4,0),o(),r(6,"div",5)(7,"span"),a(8),T(9,"timeFormat"),o()(),r(10,"div",6),M(11,j,4,0,"ng-container",7)(12,N,7,0,"ng-container",7)(13,$,7,0,"ng-container",7),o(),M(14,H,8,1,"div",8),r(15,"div",9)(16,"h3"),a(17,"\u4F7F\u7528\u8BF4\u660E\uFF1A"),o(),r(18,"ol")(19,"li"),a(20,'\u70B9\u51FB"\u5F00\u59CB\u5F55\u97F3"\u6309\u94AE\u5F00\u59CB\u5F55\u5236\u97F3\u9891'),o(),r(21,"li"),a(22,"\u5F55\u97F3\u8FC7\u7A0B\u4E2D\u53EF\u4EE5\u6682\u505C\u548C\u7EE7\u7EED"),o(),r(23,"li"),a(24,'\u70B9\u51FB"\u505C\u6B62"\u6309\u94AE\u7ED3\u675F\u5F55\u97F3'),o(),r(25,"li"),a(26,"\u5F55\u97F3\u7ED3\u675F\u540E\u53EF\u4EE5\u56DE\u653E\u6216\u4E0B\u8F7D"),o()(),r(27,"p",10),a(28,"\u6CE8\u610F\uFF1A\u8BF7\u786E\u4FDD\u5DF2\u6388\u4E88\u6D4F\u89C8\u5668\u9EA6\u514B\u98CE\u8BBF\u95EE\u6743\u9650"),o()()()),e&2&&(m(8),V(B(9,5,n.recordingTime)),m(3),g("ngIf",n.recordingState==="idle"),m(),g("ngIf",n.recordingState==="recording"),m(),g("ngIf",n.recordingState==="paused"),m(),g("ngIf",n.audioUrl))},dependencies:[I,z,D,x],styles:[".recorder-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:2rem;background:linear-gradient(135deg,#1a2a6c,#b21f1f,#1a2a6c);border-radius:16px;box-shadow:0 10px 30px #0000004d;color:#fff;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;text-align:center}.recorder-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:2rem;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.3)}.visualizer-container[_ngcontent-%COMP%]{background:#0003;border-radius:12px;padding:1rem;margin-bottom:1.5rem}.visualizer-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block;margin:0 auto;border-radius:8px;background:#0000004d}.recording-time[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;margin:1rem 0;color:#fc0;text-shadow:0 0 10px rgba(255,204,0,.5)}.controls[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1.5rem;margin:2rem 0}.controls[_ngcontent-%COMP%]   .control-btn[_ngcontent-%COMP%]{padding:.8rem 1.5rem;border:none;border-radius:50px;font-size:1.1rem;font-weight:700;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:.5rem;box-shadow:0 4px 8px #0003}.controls[_ngcontent-%COMP%]   .control-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem}.controls[_ngcontent-%COMP%]   .control-btn[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 6px 12px #0000004d}.controls[_ngcontent-%COMP%]   .control-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.controls[_ngcontent-%COMP%]   .start-btn[_ngcontent-%COMP%]{background:linear-gradient(to right,#4caf50,#2e7d32);color:#fff}.controls[_ngcontent-%COMP%]   .pause-btn[_ngcontent-%COMP%]{background:linear-gradient(to right,#ff9800,#ef6c00);color:#fff}.controls[_ngcontent-%COMP%]   .resume-btn[_ngcontent-%COMP%]{background:linear-gradient(to right,#2196f3,#0d47a1);color:#fff}.controls[_ngcontent-%COMP%]   .stop-btn[_ngcontent-%COMP%]{background:linear-gradient(to right,#f44336,#b71c1c);color:#fff}.playback-section[_ngcontent-%COMP%]{background:#ffffff1a;border-radius:12px;padding:1.5rem;margin-top:2rem}.playback-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;color:#fc0}.playback-section[_ngcontent-%COMP%]   audio[_ngcontent-%COMP%]{width:100%;margin:1rem 0;border-radius:8px}.playback-section[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]{background:linear-gradient(to right,#9c27b0,#6a1b9a);color:#fff;border:none;padding:.8rem 1.5rem;border-radius:50px;font-size:1.1rem;font-weight:700;cursor:pointer;transition:all .3s ease;display:inline-flex;align-items:center;gap:.5rem;box-shadow:0 4px 8px #0003}.playback-section[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 6px 12px #0000004d}.instructions[_ngcontent-%COMP%]{background:#ffffff1a;border-radius:12px;padding:1.5rem;margin-top:2rem;text-align:left}.instructions[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fc0;margin-top:0}.instructions[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{padding-left:1.5rem;line-height:1.6}.instructions[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{font-style:italic;color:#f99;margin-top:1rem}"]})};export{U as Microphone};
