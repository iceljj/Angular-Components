import{b as H,f as R,h as z,t as F}from"./chunk-LM5MDKJD.js";import{j as A,k as D,o as V}from"./chunk-3BOVJI26.js";import{Ac as T,Bc as S,Cc as k,Mc as y,Sb as c,Tb as a,Ub as o,Zb as h,_b as u,ac as P,fc as x,gb as r,hc as g,lc as C,mc as b,nc as M,qc as w,ra as _,sa as p,sb as O,uc as E,vc as l,wc as d,xc as I,yb as m}from"./chunk-SV3L42UN.js";import"./chunk-IJBWTILK.js";var N=["messageInput"],Q=["messageContainer"];function $(t,e){if(t&1&&(a(0,"div",20),l(1),o()),t&2){let n=g(3).$implicit;r(),I(" ",n.avatar," ")}}function Y(t,e){t&1&&(a(0,"div",20),l(1,"\u5BA2\u670D"),o())}function j(t,e){if(t&1&&(h(0),m(1,$,2,1,"div",19)(2,Y,2,0,"ng-template",null,3,y),u()),t&2){let n=w(3),i=g(2).$implicit;r(),c("ngIf",i.avatar)("ngIfElse",n)}}function W(t,e){t&1&&(a(0,"div",21),l(1,"\u5BA2\u670D"),o())}function q(t,e){if(t&1&&(h(0),a(1,"div",13),m(2,j,4,2,"ng-container",14)(3,W,2,0,"ng-template",null,2,y),o(),a(5,"div",15)(6,"div",16)(7,"div",17),l(8),o()(),a(9,"div",18),l(10),o()(),u()),t&2){let n=w(4),i=g().$implicit,s=g();r(2),c("ngIf",s.showAvatar)("ngIfElse",n),r(6),d(i.content),r(2),d(s.formatTime(i.time))}}function L(t,e){t&1&&(a(0,"div",20),l(1),o()),t&2&&(r(),d("\u6211"))}function U(t,e){t&1&&(a(0,"div",21),l(1,"\u6211"),o())}function K(t,e){if(t&1&&(h(0),a(1,"div",15)(2,"div",22)(3,"div",17),l(4),o()(),a(5,"div",18),l(6),o()(),a(7,"div",13),m(8,L,2,1,"div",23)(9,U,2,0,"div",24),o(),u()),t&2){let n=g().$implicit,i=g();r(4),d(n.content),r(2),d(i.formatTime(n.time)),r(2),c("ngIf",i.showAvatar),r(),c("ngIf",!i.showAvatar)}}function G(t,e){if(t&1&&(a(0,"div"),m(1,q,11,4,"ng-container",12)(2,K,10,4,"ng-container",12),o()),t&2){let n=e.$implicit;E(n.isMe?"message-right":"message-left"),r(),c("ngIf",!n.isMe),r(),c("ngIf",n.isMe)}}var B=class t{showAvatar=!0;headerText="\u5728\u7EBF\u5BA2\u670D";messageInput;messageContainerRef;newMessage="";messages=[];autoScrollEnabled=!0;ngOnInit(){this.messages=[{id:1,content:"\u60A8\u597D\uFF0C\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u60A8\uFF1F",isMe:!1,time:new Date(Date.now()-1e3*60*5),avatar:""},{id:2,content:"\u6211\u60F3\u54A8\u8BE2\u8BA2\u5355\u72B6\u6001\uFF0C\u8BA2\u5355\u53F7\u662F1234567890\u3002\u8FD9\u662F\u6211\u8D2D\u4E70\u7684\u5546\u54C1\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u5E0C\u671B\u60A8\u80FD\u5E2E\u6211\u67E5\u770B\u4E00\u4E0B\u7269\u6D41\u72B6\u6001\u3002",isMe:!0,time:new Date(Date.now()-1e3*60*3),avatar:"U"},{id:3,content:"\u8BF7\u63D0\u4F9B\u8BA2\u5355\u53F7\u548C\u8054\u7CFB\u7535\u8BDD\uFF0C\u6211\u4F1A\u4E3A\u60A8\u67E5\u8BE2\u7269\u6D41\u4FE1\u606F\u5E76\u5C3D\u5FEB\u56DE\u590D\u3002\u6211\u4EEC\u7684\u5BA2\u670D\u65F6\u95F4\u662F\u5DE5\u4F5C\u65E59:00-18:00\u3002",isMe:!1,time:new Date(Date.now()-1e3*60*2),avatar:""}]}ngAfterViewChecked(){this.autoScrollEnabled&&this.scrollToBottom()}onMessagesScroll(){let e=this.messageContainerRef.nativeElement;e.scrollHeight-e.scrollTop-e.clientHeight<=1?this.autoScrollEnabled=!0:this.autoScrollEnabled=!1}scrollToBottom(){try{let e=this.messageContainerRef.nativeElement;e.scrollTop=e.scrollHeight}catch(e){console.error("\u6EDA\u52A8\u5230\u5E95\u90E8\u5931\u8D25:",e)}}handleEnter(e){e.key==="Enter"&&(e.shiftKey?(this.newMessage+=`
`,setTimeout(()=>{this.adjustTextAreaHeight()})):(e.preventDefault(),this.sendMessage()))}adjustTextAreaHeight(){let e=this.messageInput.nativeElement;e.style.height="auto";let n=120,i=Math.min(e.scrollHeight,n);e.style.height=i+"px",e.style.overflowY=i===n?"auto":"hidden"}resetTextAreaHeight(){let e=this.messageInput.nativeElement;e.style.height="48px",e.style.overflowY="hidden"}sendMessage(){if(!this.newMessage.trim())return;let e={id:this.messages.length+1,content:this.newMessage,isMe:!0,time:new Date,avatar:"U"};this.messages.push(e),this.newMessage="",this.autoScrollEnabled=!0,this.resetTextAreaHeight(),setTimeout(()=>{this.messages.push({id:this.messages.length+1,content:"\u5DF2\u6536\u5230\u60A8\u7684\u4FE1\u606F\uFF0C\u6211\u4EEC\u5C06\u5C3D\u5FEB\u56DE\u590D\u60A8\u7684\u95EE\u9898\u3002\u6709\u4EFB\u4F55\u5176\u4ED6\u9700\u8981\u53EF\u4EE5\u968F\u65F6\u544A\u8BC9\u6211\u4EEC\u3002",isMe:!1,time:new Date,avatar:""})},1e3)}formatTime(e){return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=O({type:t,selectors:[["app-chat"]],viewQuery:function(n,i){if(n&1&&(C(N,5),C(Q,5)),n&2){let s;b(s=M())&&(i.messageInput=s.first),b(s=M())&&(i.messageContainerRef=s.first)}},inputs:{showAvatar:"showAvatar",headerText:"headerText"},decls:12,vars:3,consts:[["messageContainer",""],["messageInput",""],["textAvatar",""],["defaultAvatar",""],[1,"chat-container"],[1,"chat-header"],[1,"header-text"],[1,"messages-container",3,"scroll"],[3,"class",4,"ngFor","ngForOf"],[1,"input-container"],["placeholder","\u8F93\u5165\u6D88\u606F...","rows","1",3,"ngModelChange","keydown.enter","ngModel"],[3,"click"],[4,"ngIf"],[1,"avatar-container"],[4,"ngIf","ngIfElse"],[1,"message-content"],[1,"bubble","left-bubble"],[1,"message-text"],[1,"time"],["class","avatar",4,"ngIf","ngIfElse"],[1,"avatar"],[1,"avatar-text"],[1,"bubble","right-bubble"],["class","avatar",4,"ngIf"],["class","avatar-text",4,"ngIf"]],template:function(n,i){if(n&1){let s=P();a(0,"div",4)(1,"div",5)(2,"div",6),l(3),o()(),a(4,"div",7,0),x("scroll",function(){return _(s),p(i.onMessagesScroll())}),m(6,G,3,4,"div",8),o(),a(7,"div",9)(8,"textarea",10,1),k("ngModelChange",function(f){return _(s),S(i.newMessage,f)||(i.newMessage=f),p(f)}),x("keydown.enter",function(f){return _(s),p(i.handleEnter(f))}),o(),a(10,"button",11),x("click",function(){return _(s),p(i.sendMessage())}),l(11,"\u53D1\u9001"),o()()()}n&2&&(r(3),d(i.headerText),r(3),c("ngForOf",i.messages),r(2),T("ngModel",i.newMessage))},dependencies:[V,A,D,F,H,R,z],styles:[".chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;box-sizing:border-box;background-color:#f5f5f5;font-family:Roboto,sans-serif;overflow:hidden}.chat-header[_ngcontent-%COMP%]{text-align:center;padding:12px 0;border-bottom:1px solid #e0e0e0;background-color:#fff;box-shadow:0 2px 4px #0000000d}.chat-header[_ngcontent-%COMP%]   .header-text[_ngcontent-%COMP%]{font-weight:500;font-size:18px;color:#202124}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:12px 0;display:flex;flex-direction:column;scroll-behavior:smooth}.message-left[_ngcontent-%COMP%], .message-right[_ngcontent-%COMP%]{display:flex;margin-bottom:16px;max-width:90%}.message-left.message-right[_ngcontent-%COMP%], .message-right.message-right[_ngcontent-%COMP%]{align-self:flex-end}.message-left.message-right[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%], .message-right.message-right[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{text-align:end}.avatar-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;margin:0 8px}.avatar-container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background-color:#4285f4;color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:500;flex-shrink:0}.avatar-container[_ngcontent-%COMP%]   .avatar-text[_ngcontent-%COMP%]{font-size:12px;color:#5f6368}.message-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.message-content[_ngcontent-%COMP%]   .bubble[_ngcontent-%COMP%]{padding:12px;border-radius:18px;margin-bottom:4px;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.message-content[_ngcontent-%COMP%]   .bubble.left-bubble[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e0e0e0;border-bottom-left-radius:4px}.message-content[_ngcontent-%COMP%]   .bubble.right-bubble[_ngcontent-%COMP%]{background-color:#d2e3fc;color:#202124;border-bottom-right-radius:4px}.message-content[_ngcontent-%COMP%]   .bubble[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{word-wrap:break-word;white-space:pre-wrap;line-height:1.4;font-size:16px}.message-content[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:11px;color:#70757a;padding:0 4px}.input-container[_ngcontent-%COMP%]{display:flex;background-color:#fff;box-shadow:0 -1px 4px #0000000d;padding:8px;align-items:center}.input-container[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{flex:5;border:none;background-color:#f1f3f4;font-size:16px;padding:12px 16px;resize:none;min-height:48px;max-height:120px;line-height:1.4;box-sizing:border-box}.input-container[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;background-color:#fff;box-shadow:0 0 0 2px #d2e3fc}.input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;background-color:#1a73e8;color:#fff;border:none;padding:12px 0;cursor:pointer;transition:background-color .2s;margin-left:8px}.input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#1765cc}.input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{background-color:#185abc}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]})};export{B as Chat};
