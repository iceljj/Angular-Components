<div class="editor-container"
     #editorContainer
     (wheel)="onWheel($event)"
     (mousedown)="onEditorMouseDown($event)">

  <!-- 缩放容器 -->
  <div class="zoom-container"
       #zoomContainer
       [style.transform]="'translate(' + panOffset.x + 'px, ' + panOffset.y + 'px) scale(' + zoomLevel + ')'">

    <!-- 背景网格 -->
    <div class="grid"></div>

    <!-- 节点列表 -->
    <div *ngFor="let node of nodes; let i = index"
         class="node-container"
         [style.left.px]="node.position.x"
         [style.top.px]="node.position.y"
         [style.zIndex]="nodes.length - i">

      <!-- 实际节点 -->
      <div class="node"
           [id]="'node-' + i"
           [class.selected]="selectedNode === i"
           (mousedown)="$event.stopPropagation(); onNodeMouseDown($event, i)">

        <div class="node-header">
          {{ node.title }}
        </div>

        <!-- 端点 -->
        <div class="endpoint top"
             (mousedown)="$event.stopPropagation(); onEndpointMouseDown($event, i, 'top')"></div>
        <div class="endpoint right"
             (mousedown)="$event.stopPropagation(); onEndpointMouseDown($event, i, 'right')"></div>
        <div class="endpoint bottom"
             (mousedown)="$event.stopPropagation(); onEndpointMouseDown($event, i, 'bottom')"></div>
        <div class="endpoint left"
             (mousedown)="$event.stopPropagation(); onEndpointMouseDown($event, i, 'left')"></div>
      </div>
    </div>

    <!-- 连线 -->
    <div *ngFor="let connection of connections"
         class="connection"
         [style.width]="getConnectionLength(connection) + 'px'"
         [style.transform]="getConnectionTransform(connection)"
         [style.left.px]="getConnectionLeft(connection)"
         [style.top.px]="getConnectionTop(connection)">
    </div>

    <!-- 临时连线 -->
    <div *ngIf="isDrawingConnection"
         class="connection temp-connection"
         [style.width]="getTempConnectionLength() + 'px'"
         [style.transform]="getTempConnectionTransform()"
         [style.left.px]="tempConnectionStart.x"
         [style.top.px]="tempConnectionStart.y">
    </div>
  </div>

  <!-- 控件 -->
  <div class="controls">
    <button (click)="addNode()">Add Node</button>
    <span>Zoom: {{ Math.round(zoomLevel * 100) }}%</span>
    <span *ngIf="selectedNode !== null">Selected Node: {{ selectedNode }}</span>
  </div>
</div>
