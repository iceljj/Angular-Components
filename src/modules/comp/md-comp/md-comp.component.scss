// ====================
// Markdown 编辑器样式
// ====================

// 导入组件变量
@import './md-comp-variables.scss';
// 导入默认代码高亮样式
@import 'highlight.js/styles/github.css';

// 全局样式设置
// 设置html和body的背景色和溢出隐藏，防止页面滚动
html,
body {
  background: var(--bg-primary); // 使用CSS变量设置背景色
  overflow: scroll; // 强制隐藏滚动条
}

// 设置body的外边距和字体
body {
  margin: 0 !important; // 强制重置外边距
  font-family: Roboto, "Helvetica Neue", sans-serif; // 设置字体族
}

// ====================
// 组件样式
// ====================

// 包装器 - 实现居中效果
// 用于将整个编辑器组件居中显示在页面上
.markdown-editor-wrapper {
  width: 100%; // 宽度占满容器
  height: 100vh; // 最小高度为视窗高度
  overflow: hidden; // 隐藏溢出内容
  background: var(--bg-secondary); // 使用次要背景色
  display: flex; // 使用弹性布局
  align-items: center; // 垂直居中
  justify-content: center; // 水平居中
  box-sizing: border-box; // 盒模型包含内边距和边框
  // 固定预留滚动条空间，防止闪动
  scrollbar-gutter: stable both-edges;
  // 添加固定预留区域防止布局跳动
  contain: layout style paint;
  // 防止内容溢出导致滚动条出现
  overscroll-behavior: none;

}

// 主容器
// 编辑器的主要容器，包含工具栏、编辑区域和预览区域
.markdown-editor {
  width: 100%; // 宽度占满容器
  max-width: 90%; // 最大宽度限制
  height: 100vh; // 高度为视窗高度
  max-height: 90vh; // 最大高度限制
  display: flex; // 使用弹性布局
  flex-direction: column; // 垂直排列子元素
  background: var(--bg-primary); // 使用主要背景色
  color: var(--text-primary); // 使用主要文字颜色
  font-family: Roboto, "Helvetica Neue", sans-serif; // 设置字体族
  overflow: hidden; // 隐藏溢出内容
  // transition: all 0.3s ease; // 添加过渡动画效果
  border-radius: $radius-md; // 使用中等圆角
  box-shadow: $shadow-xl; // 使用大阴影效果
  scrollbar-gutter: stable both-edges; // 固定预留滚动条空间，防止闪动
  // 增强布局稳定性
  contain: layout style paint;
  // 防止内容溢出导致滚动条出现
  overscroll-behavior: none;

  // 工具栏样式
  // 工具栏容器的样式设置
  .toolbar {
    background: var(--toolbar-bg); // 使用工具栏背景色
    border-bottom: 1px solid var(--border-color); // 下边框样式

    // 工具栏按钮样式
    .toolbar-btn {
      color: var(--text-secondary); // 使用次要文字颜色

      // 按钮悬停状态样式
      &:hover {
        background: var(--bg-secondary); // 使用次要背景色
        color: var(--text-primary); // 使用主要文字颜色
      }

      // 按钮激活状态样式
      &.active {
        background: var(--color-primary); // 使用主色作为背景
        color: var(--color-white); // 使用白色文字
      }
    }

    // 字体大小控制按钮特殊样式
    // 针对字体大小控制按钮组的特殊样式设置
    .toolbar-group:last-child {
      .toolbar-btn {
        min-width: 60px; // 设置最小宽度
      }
    }
  }

  // 编辑面板样式
  // 编辑器文本区域的样式设置
  .editor-panel {
    border-right: 1px solid var(--border-color); // 右边框样式
    background: var(--editor-bg); // 使用编辑器背景色

    // 编辑器文本区域样式
    .editor-textarea {
      background: var(--editor-bg); // 使用编辑器背景色
      color: var(--text-primary); // 使用主要文字颜色
      scrollbar-gutter: stable; // 稳定滚动条槽位，防止渲染时布局跳动

      // 占位符文本样式
      &::placeholder {
        color: var(--text-tertiary); // 使用三级文字颜色
      }

      // 拖拽状态样式
      &.dragover {
        background: var(--bg-secondary); // 使用次要背景色
        border-color: var(--color-primary); // 使用主色作为边框颜色
      }
    }
  }

  // 预览面板样式
  // 预览区域的样式设置
  .preview-panel {
    background: var(--preview-bg); // 使用预览区域背景色
    color: var(--text-primary); // 使用主要文字颜色

    // 预览内容区域样式
    .preview-content {
      color: var(--text-primary); // 使用主要文字颜色

      // Markdown 元素样式
      // 标题样式（h1-h6）
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        color: var(--text-primary) !important; // 强制使用主要文字颜色
      }

      // 段落样式
      p {
        color: var(--text-primary); // 使用主要文字颜色
      }

      // 列表样式
      ul,
      ol {
        li {
          color: var(--text-primary); // 使用主要文字颜色
        }
      }

      // 引用块样式
      ::ng-deep blockquote {
        margin: 0;
        padding-left: 5px;
        border-left: 1px solid var(--color-primary); // 使用主色作为左边框颜色
      }

      // 行内代码样式
      ::ng-deep code {
        //background: var(--color-secondary-active); // 使用次要背景色
        color: var(--color-primary); // 使用主色作为文字颜色
      }

      // 代码块样式
      ::ng-deep pre {
        background-color: var(--bg-secondary); // 使用次要背景色
        border: 1px solid var(--border-color); // 边框样式

        // 代码块内代码样式
        ::ng-deep code {
          color: var(--text-primary); // 使用主要文字颜色
        }
      }

      // 表格样式
      ::ng-deep table {

        // 表格头部和单元格样式
        th,
        td {
          border-color: var(--border-color); // 使用边框颜色
          color: var(--text-primary); // 使用主要文字颜色
        }

        // 表格头部样式
        th {
          background: var(--bg-secondary); // 使用次要背景色
        }

        // 表格偶数行样式
        tr:nth-child(even) {
          background: var(--bg-secondary); // 使用次要背景色
        }
      }

      // 链接样式
      a {
        color: var(--color-primary); // 使用主色作为链接颜色

        // 链接悬停样式
        &:hover {
          color: var(--color-primary-hover); // 使用主色悬停状态颜色
        }
      }

      // 分割线样式
      hr {
        border-top-color: var(--border-color); // 使用边框颜色作为上边框颜色
      }

      // 数学公式块样式
      ::ng-deep .math-block {
        background: var(--bg-secondary); // 使用次要背景色
        border: 1px solid var(--border-color); // 边框样式
        color: var(--text-primary); // 使用主要文字颜色
      }

      // Mermaid图表容器样式
      ::ng-deep .mermaid-container {
        background: var(--bg-secondary); // 使用次要背景色
        border-color: var(--border-color); // 使用边框颜色
        color: var(--text-primary); // 使用主要文字颜色
      }

      // 确保所有子元素继承正确的文本颜色
      * {
        color: inherit; // 继承父元素文字颜色
      }
    }
  }

  // 状态栏样式
  // 底部状态栏的样式设置
  .status-bar {
    background: var(--toolbar-bg); // 使用工具栏背景色
    border-top: 1px solid var(--border-color); // 上边框样式
    color: var(--text-secondary); // 使用次要文字颜色
  }

  // 帮助覆盖层样式
  // 快捷键帮助面板的样式设置
  .help-overlay {

    // 帮助内容区域样式
    .help-content {
      background: var(--bg-primary); // 使用主要背景色
      border-color: var(--border-color); // 使用边框颜色

      // 帮助标题样式
      h3 {
        color: var(--text-primary); // 使用主要文字颜色
      }

      // 快捷键项目样式
      .shortcut-item {

        // 快捷键按键样式
        kbd {
          background: var(--bg-secondary); // 使用次要背景色
          border-color: var(--border-color); // 使用边框颜色
          color: var(--text-primary); // 使用主要文字颜色
        }

        // 快捷键描述样式
        span {
          color: var(--text-primary); // 使用主要文字颜色
        }
      }
    }
  }

  // 全屏模式
  // 全屏状态下的样式设置
  &.fullscreen {
    position: fixed; // 固定定位
    top: 0; // 顶部对齐
    left: 0; // 左侧对齐
    right: 0; // 右侧对齐
    bottom: 0; // 底部对齐
    z-index: 9999; // 设置层级
    max-width: none; // 取消最大宽度限制
    max-height: none; // 取消最大高度限制
    border-radius: 0; // 取消圆角
    box-shadow: none; // 取消阴影
  }
}

// ====================
// 工具栏样式
// ====================
// 工具栏容器的详细样式设置
.toolbar {
  display: flex; // 使用弹性布局
  align-items: center; // 垂直居中对齐
  justify-content: space-between; // 两端对齐
  padding: var(--spacing-lg); // 使用大间距作为内边距
  background: var(--toolbar-bg); // 使用工具栏背景色
  border-bottom: 1px solid var(--border-color); // 下边框样式
  box-shadow: var(--shadow); // 使用阴影效果
  flex-shrink: 0; // 不允许收缩
  gap: var(--spacing-md); // 使用中等间距作为元素间距

  // 工具栏分组样式
  .toolbar-group {
    display: flex; // 使用弹性布局
    gap: var(--spacing-sm); // 使用小间距作为元素间距
    align-items: center; // 垂直居中对齐
    flex-wrap: wrap; // 允许换行
  }

  // 工具栏按钮样式
  .toolbar-btn {
    display: flex; // 使用弹性布局
    align-items: center; // 垂直居中对齐
    justify-content: center; // 水平居中对齐
    padding: 0 var(--spacing-md); // 水平内边距
    height: 36px; // 固定高度
    border: none; // 无边框
    border-radius: var(--radius); // 使用圆角
    background: transparent; // 透明背景
    color: var(--text-secondary); // 使用次要文字颜色
    cursor: pointer; // 鼠标指针样式
    transition: all 0.2s ease; // 添加过渡动画效果
    font-size: var(--font-size-sm); // 使用小字体大小
    position: relative; // 相对定位
    overflow: hidden; // 隐藏溢出内容

    // 按钮悬停状态样式
    &:hover {
      background: var(--bg-secondary); // 使用次要背景色
      color: var(--text-primary); // 使用主要文字颜色
      transform: translateY(-1px); // 向上移动1像素
    }

    // 按钮激活状态样式
    &.active {
      background: var(--color-primary); // 使用主色作为背景
      color: var(--color-white); // 使用白色文字
    }

    // 按钮聚焦状态样式
    &:focus {
      outline: 2px solid var(--color-primary); // 使用主色作为轮廓
      outline-offset: 2px; // 轮廓偏移
    }

    // 添加按钮波纹效果
    &:after {
      content: ''; // 伪元素内容为空
      position: absolute; // 绝对定位
      top: 50%; // 垂直居中
      left: 50%; // 水平居中
      width: 5px; // 宽度
      height: 5px; // 高度
      background: rgba(255, 255, 255, 0.5); // 半透明白色背景
      opacity: 0; // 透明度为0
      border-radius: 100%; // 圆形
      transform: scale(1, 1) translate(-50%, -50%); // 缩放和平移
      transform-origin: 50% 50%; // 变换原点
    }

    // 按钮按下时的波纹动画
    &:active:after {
      animation: ripple 0.6s ease-out; // 波纹动画效果
    }
  }

  // 按钮文本样式
  .btn-text {
    margin-left: var(--spacing-xs); // 左外边距
    font-size: 110%; // 字体大小为110%
    font-weight: 500; // 字体粗细
  }

  // 主题选择器包装器样式
  .theme-selector-wrapper {
    position: relative; // 相对定位
    display: inline-block; // 内块显示

    // 主题选择按钮样式
    .theme-selector-btn {
      position: relative; // 相对定位
      min-width: 140px; // 最小宽度
      justify-content: space-between; // 两端对齐

      .dropdown-arrow {
        font-size: 0.8em; // 字体大小
        transition: transform 0.2s ease; // 转换动画
        margin-left: var(--spacing-xs); // 左外边距

        &.open {
          transform: rotate(180deg); // 旋转180度
        }
      }
    }

    // 主题下拉菜单样式
    .theme-dropdown {
      position: absolute; // 绝对定位
      top: 100%; // 顶部位置
      left: 0; // 左侧对齐
      right: 0; // 右侧对齐
      background: var(--bg-primary); // 使用主要背景色
      border: 1px solid var(--border-color); // 边框样式
      border-radius: var(--radius); // 使用圆角
      box-shadow: var(--shadow-lg); // 使用大阴影效果
      z-index: 1000; // 设置层级
      min-width: 280px; // 最小宽度
      max-height: 400px; // 最大高度
      overflow-y: auto; // 垂直方向自动显示滚动条
      margin-top: var(--spacing-xs); // 上外边距

      // 隐藏状态
      opacity: 0; // 透明度为0
      visibility: hidden; // 隐藏
      transform: translateY(-10px); // 向上平移
      transition: all 0.2s ease; // 过渡动画

      // 显示状态
      &.show {
        opacity: 1; // 透明度为1
        visibility: visible; // 显示
        transform: translateY(0); // 重置平移
      }

      // 下拉菜单头部
      .theme-dropdown-header {
        display: flex; // 使用弹性布局
        justify-content: space-between; // 两端对齐
        align-items: center; // 垂直居中对齐
        padding: var(--spacing-md); // 内边距
        border-bottom: 1px solid var(--border-color); // 下边框样式
        background: var(--bg-secondary); // 使用次要背景色
        font-weight: 600; // 字体粗细
        font-size: var(--font-size-sm); // 使用小字体大小
        color: var(--text-primary); // 使用主要文字颜色

        .close-btn {
          background: none; // 无背景
          border: none; // 无边框
          color: var(--text-secondary); // 使用次要文字颜色
          cursor: pointer; // 鼠标指针
          padding: 4px; // 内边距
          border-radius: var(--radius-sm); // 使用小圆角

          &:hover {
            background: var(--bg-tertiary); // 使用第三背景色
            color: var(--text-primary); // 使用主要文字颜色
          }
        }
      }

      // 主题选项容器
      .theme-options {
        padding: var(--spacing-sm); // 内边距
        display: flex; // 使用弹性布局
        flex-direction: column; // 垂直排列
        gap: 2px; // 元素间距
      }

      // 主题选项按钮
      .theme-option {
        display: flex; // 使用弹性布局
        align-items: center; // 垂直居中对齐
        padding: var(--spacing-sm) var(--spacing-md); // 内边距
        background: none; // 无背景
        border: none; // 无边框
        border-radius: var(--radius-sm); // 使用小圆角
        cursor: pointer; // 鼠标指针
        transition: all 0.2s ease; // 过渡动画
        text-align: left; // 文本左对齐
        width: 100%; // 宽度为100%
        gap: var(--spacing-sm); // 元素间距

        &:hover {
          background: var(--bg-secondary); // 使用次要背景色
          color: var(--text-primary); // 使用主要文字颜色
        }

        &.selected {
          background: var(--color-primary); // 使用主色背景
          color: var(--color-white); // 使用白色文字

          .theme-category {
            color: rgba(255, 255, 255, 0.8); // 半透明白色
          }
        }

        // 主题预览小方块
        .theme-preview {
          width: 20px; // 宽度
          height: 20px; // 高度
          border-radius: var(--radius-sm); // 使用小圆角
          border: 1px solid var(--border-color); // 边框样式
          flex-shrink: 0; // 不允许收缩

          // 不同主题的颜色预览
          &[data-theme="github"] {
            background: linear-gradient(45deg, #f6f8fa, #24292e);
          }

          &[data-theme="vs2015"] {
            background: linear-gradient(45deg, #1e1e1e, #569cd6);
          }

          &[data-theme="monokai"] {
            background: linear-gradient(45deg, #272822, #f92672);
          }

          &[data-theme="solarized-dark"] {
            background: linear-gradient(45deg, #002b36, #268bd2);
          }

          &[data-theme="solarized-light"] {
            background: linear-gradient(45deg, #fdf6e3, #657b83);
          }

          &[data-theme="atom-one-dark"] {
            background: linear-gradient(45deg, #282c34, #98c379);
          }

          &[data-theme="atom-one-light"] {
            background: linear-gradient(45deg, #fafafa, #a626a4);
          }

          &[data-theme="dracula"] {
            background: linear-gradient(45deg, #282a36, #bd93f9);
          }

          &[data-theme="nord"] {
            background: linear-gradient(45deg, #2e3440, #88c0d0);
          }

          &[data-theme="tomorrow-night"] {
            background: linear-gradient(45deg, #1d1f21, #c5c8c6);
          }
        }

        // 主题名称
        .theme-name {
          flex: 1; // 占据剩余空间
          font-weight: 500; // 字体粗细
          color: var(--text-primary); // 使用主要文字颜色
        }

        // 主题类别标签
        .theme-category {
          font-size: var(--font-size-xs); // 使用超小字体
          color: var(--text-secondary); // 使用次要文字颜色
          background: var(--bg-secondary); // 使用次要背景色
          padding: 2px 6px; // 内边距
          border-radius: var(--radius-sm); // 使用小圆角
          border: 1px solid var(--border-color); // 边框样式

          &.dark {
            background: var(--color-gray-700); // 使用深色背景
            color: var(--color-white); // 使用白色文字
            border-color: var(--color-gray-600); // 使用深色边框
          }
        }
      }
    }
  }

  // 增加按钮整体字体大小
  .toolbar-btn {
    font-size: var(--font-size); // 使用全局字体大小变量
  }
}


// ====================
// 编辑器容器
// ====================
// 编辑器主容器样式，包含编辑面板和预览面板
.editor-container {
  display: flex; // 使用弹性布局
  flex: 1; // 占据剩余空间
  overflow: hidden; // 隐藏溢出内容
  position: relative; // 相对定位
  // 固定预留滚动条空间，防止闪动
  scrollbar-gutter: stable both-edges;
  // 防止内容溢出导致滚动条出现
  overscroll-behavior: none;

  // 防止渲染时的布局跳动
  contain: layout style paint; // 包含布局、样式和绘制
}

// 编辑面板
// 编辑器文本区域容器样式
.editor-panel {
  flex: 0 0 50%; // 固定50%宽度，不允许伸缩
  max-width: 50%; // 最大宽度50%
  min-width: 50%; // 最小宽度50%
  display: flex; // 使用弹性布局
  flex-direction: column; // 垂直排列子元素
  border-right: 1px solid var(--border-color); // 右边框样式
  background: var(--editor-bg); // 使用编辑器背景色
  transition: all 0.3s ease; // 添加过渡动画效果
  // 固定预留滚动条空间，防止闪动
  scrollbar-gutter: stable both-edges;
  // 防止内容溢出导致滚动条出现
  overscroll-behavior: none;
  // 防止布局跳动
  contain: layout size;

  // 隐藏状态样式
  &.hidden {
    display: none; // 隐藏元素
  }

  // 编辑器文本区域样式
  .editor-textarea {
    flex: 1; // 占据剩余空间
    border: none; // 无边框
    outline: none; // 无轮廓
    padding: var(--spacing-xl); // 使用大间距作为内边距
    font-family: var(--mono-font); // 使用等宽字体
    font-size: var(--font-size); // 使用字体大小变量
    line-height: var(--line-height); // 使用行高变量
    background: var(--editor-bg); // 使用编辑器背景色
    color: var(--text-primary); // 使用主要文字颜色
    resize: none; // 禁止调整大小
    tab-size: 2; // 设置制表符大小为2
    transition: all 0.2s ease; // 添加过渡动画效果
    overflow: auto; // 自动显示滚动条
    // 固定预留滚动条空间，防止闪动
    scrollbar-gutter: stable both-edges;
    // 防止内容溢出导致滚动条出现
    overscroll-behavior: none;
    // 增强布局稳定性
    contain: layout style paint;

    // 占位符文本样式
    &::placeholder {
      color: var(--text-tertiary); // 使用三级文字颜色
      opacity: 0.7; // 透明度为0.7
    }

    // 拖拽状态
    &.dragover {
      background: var(--bg-secondary); // 使用次要背景色
      border: 2px dashed var(--color-primary); // 使用主色虚线边框
    }
  }
}

// 预览面板
// Markdown预览区域容器样式
.preview-panel {
  flex: 0 0 50%; // 固定50%宽度，不允许伸缩
  max-width: 50%; // 最大宽度50%
  min-width: 50%; // 最小宽度50%
  display: flex; // 使用弹性布局
  flex-direction: column; // 垂直排列子元素
  background: var(--preview-bg); // 使用预览区域背景色
  transition: all 0.3s ease; // 添加过渡动画效果
  // 固定预留滚动条空间，防止闪动
  scrollbar-gutter: stable both-edges;
  // 防止内容溢出导致滚动条出现
  overscroll-behavior: none;
  // 防止布局跳动
  contain: layout size;

  // 全宽状态样式
  &.full-width {
    flex: 0 0 100%; // 全宽模式
    max-width: 100%; // 最大宽度100%
    min-width: 100%; // 最小宽度100%
  }

  // 隐藏状态样式
  &.hidden {
    display: none; // 隐藏元素
  }


  // 预览内容区域样式
  .preview-content {
    flex: 1; // 占据剩余空间
    padding: var(--spacing-xl); // 使用大间距作为内边距
    overflow-y: auto; // 垂直方向自动显示滚动条
    line-height: var(--line-height-lg); // 使用大行高
    // 固定预留滚动条空间，防止闪动
    scrollbar-gutter: stable both-edges;
    // 防止内容溢出导致滚动条出现
    overscroll-behavior: none;
    color: var(--text-primary); // 确保文字颜色正确应用
    // 增强布局稳定性
    contain: layout style paint;
    // 优化渲染性能
    will-change: contents;
    // 防止布局跳动
    transform: translateZ(0); // 开启硬件加速

    // 强制应用颜色到所有子元素
    &,
    * {
      color: var(--text-primary) !important; // 强制使用主要文字颜色
    }

    // Markdown 渲染样式
    // 标题样式
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin-top: var(--spacing-xl); // 上外边距
      margin-bottom: var(--spacing-lg); // 下外边距
      font-weight: 600; // 字体粗细
      line-height: 1.3; // 行高
      color: var(--text-primary) !important; // 强制使用主要文字颜色

      // 第一个子元素样式
      &:first-child {
        margin-top: 0; // 重置上外边距
      }
    }

    // 一级标题样式
    h1 {
      font-size: var(--font-size-xxl); // 使用超大字体大小
      border-bottom: 1px solid var(--border-color); // 下边框样式
      padding-bottom: var(--spacing-md); // 下内边距
    }

    // 二级标题样式
    h2 {
      font-size: var(--font-size-xl); // 使用特大字体大小
      border-bottom: 1px solid var(--border-color); // 下边框样式
      padding-bottom: var(--spacing-sm); // 下内边距
    }

    // 三级标题样式
    h3 {
      font-size: var(--font-size-lg); // 使用大字体大小
    }

    // 四级标题样式
    h4 {
      font-size: var(--font-size-md); // 使用中等字体大小
    }

    // 五级标题样式
    h5 {
      font-size: var(--font-size-sm); // 使用小字体大小
    }

    // 六级标题样式
    h6 {
      font-size: var(--font-size-xs); // 使用超小字体大小
      color: var(--text-secondary) !important; // 使用次要文字颜色
    }

    // 段落样式
    p {
      margin-bottom: var(--spacing-lg); // 下外边距
      line-height: var(--line-height); // 行高
      color: var(--text-primary) !important; // 强制使用主要文字颜色
    }

    // 列表样式
    ul,
    ol {
      margin-bottom: var(--spacing-lg); // 下外边距
      padding-left: 2em; // 左内边距

      // 列表项样式
      li {
        margin-bottom: var(--spacing-sm); // 下外边距
        line-height: var(--line-height); // 行高
        color: var(--text-primary) !important; // 强制使用主要文字颜色
      }
    }

    // 引用块样式
    ::ng-deep blockquote {
      margin: var(--spacing-lg) 0; // 垂直外边距
      padding: var(--spacing-md) var(--spacing-lg); // 内边距
      border-left: 4px solid var(--color-primary); // 左边框样式
      background: var(--bg-secondary); // 使用次要背景色
      color: var(--text-secondary) !important; // 使用次要文字颜色
      border-radius: 0 var(--radius) var(--radius) 0; // 右侧圆角

      // 引用块内段落样式
      p {
        margin-bottom: var(--spacing-sm); // 下外边距

        // 最后一个段落样式
        &:last-child {
          margin-bottom: 0; // 重置下外边距
        }
      }
    }

    // 行内代码样式
    ::ng-deep code {
      padding: 2px 6px; // 内边距
      //background: var(--bg-secondary); // 使用次要背景色
      border-radius: var(--radius-sm); // 使用小圆角
      font-family: var(--mono-font); // 使用等宽字体
      font-size: 0.9em; // 字体大小
      color: var(--color-primary) !important; // 使用主色作为文字颜色
    }

    // 代码块样式
    ::ng-deep pre {
      margin: var(--spacing-xl) 0; // 垂直外边距
      padding: var(--spacing-lg); // 内边距
      background: var(--code-block-bg); // 使用代码块背景色
      border-radius: var(--radius); // 使用圆角
      overflow-x: auto; // 水平方向自动显示滚动条
      border: 1px solid var(--border-color); // 边框样式
      position: relative; // 相对定位
      color: var(--text-primary) !important; // 强制使用主要文字颜色

      // 代码块内代码样式
      ::ng-deep code {
        padding: 0; // 重置内边距
        background: transparent; // 透明背景
        color: var(--text-primary) !important; // 使用主要文字颜色
      }

      // 代码语言选择器 - 右下角
      .language-selector,
      .theme-selector {
        position: absolute; // 绝对定位
        bottom: 8px; // 距离底部8px
        right: 8px; // 距离右侧8px
        background: var(--bg-primary); // 使用主要背景色
        border: 1px solid var(--border-color); // 边框样式
        border-radius: var(--radius-sm); // 使用小圆角
        padding: 4px 8px; // 内边距
        font-size: var(--font-size-sm); // 使用小字体大小
        color: var(--text-secondary); // 使用次要文字颜色
        cursor: pointer; // 鼠标指针样式
        transition: all 0.2s ease; // 添加过渡动画效果
        outline: none; // 无轮廓

        // 选择器悬停状态样式
        &:hover {
          background: var(--bg-secondary); // 使用次要背景色
          color: var(--text-primary); // 使用主要文字颜色
          border-color: var(--border-color-hover); // 使用悬停边框颜色
        }

        // 选择器聚焦状态样式
        &:focus {
          box-shadow: 0 0 0 2px rgba(var(--color-primary), 0.2); // 使用主色阴影
        }

        // 美化下拉箭头
        appearance: none; // 重置默认外观
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); // 下拉箭头图标
        background-repeat: no-repeat; // 背景不重复
        background-position: right 8px center; // 背景位置
        background-size: 14px; // 背景大小
        padding-right: 28px; // 右内边距
      }
    }

    // 代码块容器样式
    ::ng-deep .code-block-container {
      margin: var(--spacing-xl) 0; // 垂直外边距
      border-radius: var(--radius); // 使用圆角
      overflow: hidden; // 隐藏溢出内容
      border: 1px solid var(--border-color); // 边框样式
      background: var(--code-block-bg); // 使用代码块背景色

      // 代码块头部样式
      .code-block-header {
        display: flex; // 使用弹性布局
        justify-content: space-between; // 两端对齐
        align-items: center; // 垂直居中对齐
        padding: var(--spacing-sm) var(--spacing-md); // 内边距
        background: var(--bg-secondary); // 使用次要背景色
        border-bottom: 1px solid var(--border-color); // 下边框样式
        font-size: var(--font-size-sm); // 使用小字体大小

        // 代码语言标签样式
        .code-language {
          font-family: var(--mono-font); // 使用等宽字体
          font-weight: 600; // 字体粗细
          color: var(--text-secondary); // 使用次要文字颜色
          background: var(--bg-primary); // 使用主要背景色
          padding: 2px 6px; // 内边距
          border-radius: var(--radius-sm); // 使用小圆角
          border: 1px solid var(--border-color); // 边框样式
        }

        // 代码语言选择器样式
        .code-language-selector {
          background: var(--bg-primary); // 使用主要背景色
          border: 1px solid var(--border-color); // 边框样式
          border-radius: var(--radius-sm); // 使用小圆角
          padding: 4px 8px; // 内边距
          font-size: var(--font-size-xs); // 使用超小字体大小
          color: var(--text-primary); // 使用主要文字颜色
          cursor: pointer; // 鼠标指针
          transition: all 0.2s ease; // 过渡动画
          outline: none; // 无轮廓
          min-width: 120px; // 最小宽度

          &:hover {
            background: var(--bg-secondary); // 悬停背景色
            border-color: var(--color-primary); // 悬停边框色
          }

          &:focus {
            box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2); // 聚焦阴影
            border-color: var(--color-primary); // 聚焦边框色
          }
        }
      }

      color: var(--text-primary); // 使用主要文字颜色
      cursor: pointer; // 鼠标指针样式
      transition: all 0.2s ease; // 添加过渡动画效果
      outline: none; // 无轮廓
      min-width: 100px; // 最小宽度

      // 选择器悬停状态样式
      &:hover {
        background: var(--bg-tertiary); // 使用三级背景色
        border-color: var(--color-primary); // 使用主色边框
      }

      // 选择器聚焦状态样式
      &:focus {
        box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2); // 使用主色阴影
        border-color: var(--color-primary); // 使用主色边框
      }

      // 美化下拉箭头
      appearance: none; // 重置默认外观
      background-repeat: no-repeat; // 背景不重复
      background-position: right 6px center; // 背景位置
      background-size: 12px; // 背景大小
    }
  }

  // 代码块内容样式
  pre {
    margin: 0; // 重置外边距
    border: none; // 无边框
    border-radius: 0; // 无圆角
    background: transparent; // 透明背景

    code {
      background: transparent; // 透明背景
      color: var(--text-primary); // 使用主要文字颜色
    }
  }
}


// 表格样式
::ng-deep table {
  width: 100%; // 宽度为100%
  margin: var(--spacing-xl) 0; // 垂直外边距
  border-collapse: collapse; // 边框合并
  border-spacing: 0; // 边框间距为0
  border-radius: var(--radius); // 使用圆角
  overflow: hidden; // 隐藏溢出内容
  box-shadow: var(--shadow-sm); // 使用小阴影效果

  // 表格头部和单元格样式
  th,
  td {
    padding: var(--spacing-md) var(--spacing-lg); // 内边距
    border: 1px solid var(--border-color); // 边框样式
    text-align: left; // 文本左对齐
    color: var(--text-primary) !important; // 使用主要文字颜色
  }

  // 表格头部样式
  th {
    background: var(--bg-secondary); // 使用次要背景色
  }

  // 表格偶数行样式
  tr:nth-child(even) {
    background: var(--bg-secondary); // 使用次要背景色
  }
}

// 图片样式
img {
  max-width: 100%; // 最大宽度为100%
  height: auto; // 高度自适应
  border-radius: var(--radius); // 使用圆角
  box-shadow: var(--shadow-lg); // 使用大阴影效果
  margin: var(--spacing-xl) 0; // 垂直外边距
  transition: transform 0.2s ease; // 添加变换过渡动画

  // 图片悬停状态样式
  &:hover {
    transform: scale(1.02); // 缩放1.02倍
  }
}

// 链接样式
a {
  color: var(--color-primary); // 使用主色作为链接颜色
  text-decoration: none; // 无文本装饰
  transition: all 0.2s ease; // 添加过渡动画效果

  // 链接悬停状态样式
  &:hover {
    text-decoration: underline; // 添加下划线
    color: var(--color-primary-hover); // 使用主色悬停状态颜色
  }
}

// 分割线样式
hr {
  margin: var(--spacing-xl) 0; // 垂直外边距
  border: none; // 无边框
  border-top: 1px solid var(--border-color); // 上边框样式
}

// 数学公式块样式
::ng-deep .math-block {
  margin: var(--spacing-xl) 0; // 垂直外边距
  text-align: center; // 文本居中
  overflow-x: auto; // 水平方向自动显示滚动条
  background: var(--bg-secondary); // 使用次要背景色
  border: 1px solid var(--border-color); // 边框样式
  padding: var(--spacing-md); // 内边距
  border-radius: var(--radius); // 圆角
}

// 数学公式错误样式
::ng-deep .math-error {
  margin: var(--spacing-xl) 0; // 垂直外边距
  text-align: center; // 文本居中
  padding: var(--spacing-md); // 内边距
  background: var(--bg-error, #ffeaea); // 错误背景色
  border: 1px solid var(--border-error, #ff6b6b); // 错误边框色
  border-radius: var(--radius); // 圆角
  color: var(--text-error, #d63031); // 错误文本颜色
  font-style: italic; // 斜体
}

// Mermaid 图表容器样式
::ng-deep .mermaid-container {
  margin: var(--spacing-xl) 0; // 垂直外边距
  text-align: center; // 文本居中
  padding: var(--spacing-lg); // 内边距
  background: var(--bg-secondary); // 使用次要背景色
  border-radius: var(--radius); // 使用圆角
  border: 1px solid var(--border-color); // 边框样式
  position: relative; // 相对定位
  // 根据记忆知识：设置overflow: visible防止文字被截断
  overflow: visible; // 防止SVG内部文字被截断
  min-height: 100px; // 最小高度，保持布局稳定
  // 优化渲染性能
  contain: layout style;
  will-change: contents;
  // 防止滚动条闪动
  box-sizing: border-box;
  // 硬件加速
  transform: translateZ(0);

  // Mermaid图表SVG样式 - 根据记忆知识优化文字渲染
  svg {
    max-width: 100%; // 最大宽度为100%
    height: auto; // 高度自适应
    display: block; // 块级显示
    margin: 0 auto; // 居中显示
    // 确保SVG完全渲染后再显示
    opacity: 1;
    transition: opacity 0.2s ease;
    // 根据记忆知识：强制应用字体样式到SVG内部文字
    font-family: 'Trebuchet MS', Verdana, Arial, sans-serif !important;

    // 确保SVG内部文字样式正确 - 修复文字位置偏移
    text {
      font-family: 'Trebuchet MS', Verdana, Arial, sans-serif !important;
      font-size: 14px !important;
      fill: currentColor !important;
      // 修复文字定位问题
      dominant-baseline: central !important;
      text-anchor: middle !important;
    }

    // 修复节点标签和边标签的位置
    .nodeLabel,
    .edgeLabel {
      font-family: 'Trebuchet MS', Verdana, Arial, sans-serif !important;
      dominant-baseline: central !important;
      text-anchor: middle !important;
    }

    // 修复流程图节点文字位置
    .node {
      text {
        dominant-baseline: central !important;
        text-anchor: middle !important;
      }
    }

    // 修复连线文字位置
    .edgePath {
      text {
        dominant-baseline: central !important;
        text-anchor: middle !important;
      }
    }

    // 修复标题文字位置
    .titleText {
      dominant-baseline: central !important;
      text-anchor: middle !important;
    }
  }

  // 错误提示样式
  p {
    margin: 0;
    font-style: italic;
    padding: 1rem;
    min-height: 60px; // 保持最小高度
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
  }

  // 错误渲染清理：对于意外的错误SVG进行隐藏
  svg[aria-roledescription="error"],
  svg[data-error="true"],
  .error-svg {
    display: none !important;
    position: absolute !important;
    left: -9999px !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }

  // 隐藏可能的错误容器
  div[id^="dmermaid-svg-"] {
    &:has(svg[aria-roledescription="error"]) {
      display: none !important;
    }
  }

  // 自定义错误消息样式
  .mermaid-error-message {
    color: var(--text-secondary);
    font-style: italic;
    padding: 1rem;
    text-align: center;
  }
}

// Mermaid组件样式
app-mermaid-diagram {
  display: block;
  width: 100%;
}

// ====================
// Notion式编辑器样式
// ====================
.notion-editor {
  flex: 1; // 占据剩余空间
  display: flex; // 使用弹性布局
  flex-direction: column; // 垂直排列子元素
  background: var(--editor-bg); // 使用编辑器背景色
  transition: all 0.3s ease; // 添加过渡动画效果

  &.hidden {
    display: none; // 隐藏元素
  }

  .notion-content {
    flex: 1; // 占据剩余空间
    padding: var(--spacing-xl); // 使用大间距作为内边距
    font-size: var(--font-size); // 使用字体大小变量
    line-height: var(--line-height-lg); // 使用大行高
    color: var(--text-primary); // 使用主要文字颜色
    outline: none; // 无轮廓
    overflow-y: auto; // 垂直方向自动显示滚动条
    scrollbar-gutter: stable both-edges; // 固定预留滚动条空间，防止闪动

    // 占位符样式
    &[placeholder]:empty:before {
      content: attr(placeholder);
      color: var(--text-tertiary);
      pointer-events: none;
    }

    // Notion行样式
    .notion-line {
      min-height: 1.5em;
      margin-bottom: var(--spacing-sm);
      position: relative;

      &:hover {
        background: var(--bg-secondary);
        border-radius: var(--radius-sm);
      }
    }

    // 标题样式
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: var(--spacing-lg) 0 var(--spacing-md) 0;
      font-weight: 600;
      color: var(--text-primary);
    }

    h1 {
      font-size: var(--font-size-xxl);
    }

    h2 {
      font-size: var(--font-size-xl);
    }

    h3 {
      font-size: var(--font-size-lg);
    }

    // 引用样式
    blockquote {
      margin: var(--spacing-lg) 0;
      padding: var(--spacing-md) var(--spacing-lg);
      border-left: 4px solid var(--color-primary);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      border-radius: 0 var(--radius) var(--radius) 0;
    }

    // 列表样式
    ul,
    ol {
      margin: var(--spacing-lg) 0;
      padding-left: 2em;

      li {
        margin-bottom: var(--spacing-sm);
        line-height: var(--line-height);
      }
    }

    // 代码块样式
    pre {
      margin: var(--spacing-xl) 0;
      padding: var(--spacing-lg);
      background: var(--code-block-bg);
      border-radius: var(--radius);
      overflow-x: auto;
      border: 1px solid var(--border-color);

      code {
        background: transparent;
        padding: 0;
        color: var(--text-primary);
      }
    }

    // 行内代码样式
    code {
      background: var(--bg-secondary);
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      font-family: var(--mono-font);
      font-size: 0.9em;
      color: var(--color-primary);
    }
  }
}

// Notion模式下的容器样式
.editor-container.notion-mode {
  .notion-editor {
    width: 100%;
  }
}

// ====================
// 状态栏
// ====================
// 底部状态栏样式
.status-bar {
  display: flex; // 使用弹性布局
  justify-content: space-between; // 两端对齐
  align-items: center; // 垂直居中对齐
  padding: var(--spacing-md) var(--spacing-lg); // 内边距设置
  background: var(--toolbar-bg); // 使用工具栏背景色
  border-top: 1px solid var(--border-color); // 上边框样式
  font-size: var(--font-size-xs); // 使用超小字体大小
  color: var(--text-secondary); // 使用次要文字颜色
  flex-shrink: 0; // 不允许收缩

  // 状态栏左右区域样式
  .status-left,
  .status-right {
    display: flex; // 使用弹性布局
    gap: var(--spacing-md); // 元素间距
  }

  // 状态项样式
  .status-item {
    white-space: nowrap; // 不换行
  }
}

// ====================
// 帮助覆盖层
// ====================
// 快捷键帮助面板覆盖层样式
.help-overlay {
  position: fixed; // 固定定位
  top: 0; // 顶部对齐
  left: 0; // 左侧对齐
  right: 0; // 右侧对齐
  bottom: 0; // 底部对齐
  background: rgba(0, 0, 0, 0.6); // 半透明黑色背景
  display: none; // 默认隐藏
  justify-content: center; // 水平居中对齐
  align-items: center; // 垂直居中对齐
  z-index: 1000; // 设置层级
  backdrop-filter: blur(4px); // 背景模糊效果

  // 显示状态样式
  &.show {
    display: flex; // 显示元素
  }

  // 帮助内容区域样式
  .help-content {
    background: var(--bg-primary); // 使用主要背景色
    border-radius: var(--radius); // 使用圆角
    padding: var(--spacing-xl); // 使用大间距作为内边距
    max-width: 400px; // 最大宽度
    box-shadow: var(--shadow-xl); // 使用大阴影效果
    border: 1px solid var(--border-color); // 边框样式

    // 帮助标题样式
    h3 {
      margin: 0 0 var(--spacing-lg) 0; // 外边距设置
      color: var(--text-primary); // 使用主要文字颜色
    }

    // 快捷键列表样式
    .shortcut-list {
      display: flex; // 使用弹性布局
      flex-direction: column; // 垂直排列子元素
      gap: var(--spacing-md); // 元素间距
    }

    // 快捷键项目样式
    .shortcut-item {
      display: flex; // 使用弹性布局
      justify-content: space-between; // 两端对齐
      align-items: center; // 垂直居中对齐

      // 快捷键按键样式
      kbd {
        background: var(--bg-secondary); // 使用次要背景色
        border: 1px solid var(--border-color); // 边框样式
        border-radius: var(--radius-sm); // 使用小圆角
        padding: var(--spacing-xs) var(--spacing-sm); // 内边距
        font-family: var(--mono-font); // 使用等宽字体
        font-size: 11px; // 字体大小
        color: var(--text-primary); // 使用主要文字颜色
        box-shadow: var(--shadow-sm); // 使用小阴影效果
      }

      // 快捷键描述样式
      span {
        color: var(--text-primary); // 使用主要文字颜色
      }
    }
  }
}


// ====================
// 动画效果
// ====================
.markdown-editor * {
  box-sizing: border-box;
}

// 滑动条样式
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 4px;

  &:hover {
    background: var(--text-secondary);
  }
}

// 针对编辑器和预览区域的滚动条优化，减少渲染时的闪烁
.editor-textarea,
.preview-content {
  // 使用overlay模式隐藏滚动条，除非正在滚动
  scrollbar-width: thin;
  scrollbar-color: var(--border-color) var(--bg-secondary);

  &::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  &::-webkit-scrollbar-track {
    background: var(--bg-secondary);
  }

  &::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;

    &:hover {
      background: var(--text-secondary);
    }
  }
}

// 高亮样式覆盖
// 覆盖highlight.js的默认样式
.hljs {
  background: var(--bg-secondary) !important;
  color: var(--text-primary) !important;
}

// 打印样式
// 媒体查询：打印时的样式调整
@media print {

  // 打印时编辑器样式调整
  .markdown-editor {

    // 隐藏工具栏和状态栏
    .toolbar,
    .status-bar {
      display: none; // 隐藏元素
    }

    // 隐藏编辑面板
    .editor-panel {
      display: none; // 隐藏元素
    }

    // 调整预览面板样式
    .preview-panel {
      flex: none; // 不占据弹性空间
      width: 100%; // 宽度为100%

    }
  }
}

// 焦点样式
// 编辑器文本区域聚焦状态样式
.editor-textarea:focus {
  box-shadow: inset 0 0 0 2px var(--color-primary); // 使用主色内阴影
}

// 加载动画
// 旋转动画关键帧
@keyframes spin {
  0% {
    transform: rotate(0deg); // 初始状态：旋转0度
  }

  100% {
    transform: rotate(360deg); // 结束状态：旋转360度
  }
}

// 加载状态样式
.loading {
  animation: spin 1s linear infinite; // 旋转动画效果
}

// 过渡动画
// 为预览面板、编辑面板和编辑器添加过渡动画
//.preview-panel,
//.editor-panel,
//.markdown-editor {
//  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); // 添加过渡动画效果
//}
