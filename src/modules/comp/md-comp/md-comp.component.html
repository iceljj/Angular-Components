<div class="markdown-editor-wrapper" [class.dark-theme]="isDarkTheme">
  <div class="markdown-editor" [ngClass]="getThemeClass()" [class.dark-theme]="isDarkTheme">
    <!-- å·¥å…·æ  -->
    <div class="toolbar">
      <div class="toolbar-group">
        <!-- æ ¼å¼åŒ–å·¥å…· -->
        <button
          *ngFor="let action of toolbarActions"
          class="toolbar-btn"
          [title]="action.name + (action.shortcut ? ' (' + action.shortcut + ')' : '')"
          (click)="action.action()">
          <span [innerHTML]="action.icon"></span>
          <span class="btn-text">{{ action.name }}</span>
        </button>
      </div>

      <div class="toolbar-group">
        <!-- æ–‡ä»¶æ“ä½œ -->
        <button class="toolbar-btn" title="æ‰“å¼€æ–‡ä»¶ (Ctrl+O)" (click)="openFile()">
          ğŸ“
          <span class="btn-text">æ‰“å¼€</span>
        </button>
        <button class="toolbar-btn" title="ä¿å­˜ Markdown (Ctrl+S)" (click)="saveMarkdown()">
          ğŸ’¾
          <span class="btn-text">ä¿å­˜</span>
        </button>
        <button class="toolbar-btn" title="å¯¼å‡º HTML" (click)="exportHtml()">
          ğŸŒ
          <span class="btn-text">å¯¼å‡º</span>
        </button>
      </div>

      <div class="toolbar-group">
        <!-- è§†å›¾æ§åˆ¶ -->
        <button class="toolbar-btn" [class.active]="isDarkTheme" title="åˆ‡æ¢ä¸»é¢˜" (click)="toggleTheme()">
          ğŸŒ™
          <span class="btn-text">ä¸»é¢˜</span>
        </button>
        
        <!-- ä»£ç é«˜äº®ä¸»é¢˜é€‰æ‹©å™¨ -->
        <div class="theme-selector-wrapper">
          <button class="toolbar-btn theme-selector-btn" 
                  title="å…¨å±€ä»£ç é«˜äº®ä¸»é¢˜: {{getCurrentCodeThemeName()}}"
                  (click)="toggleThemeSelector()">
            ğŸ¨
            <span class="btn-text">{{getCurrentCodeThemeName()}}</span>
            <span class="dropdown-arrow" [class.open]="isThemeSelectorOpen">â–¼</span>
          </button>
          
          <!-- ä¸»é¢˜é€‰æ‹©ä¸‹æ‹‰èœå• -->
          <div class="theme-dropdown" [class.show]="isThemeSelectorOpen">
            <div class="theme-dropdown-header">
              <span>ğŸ¨ å…¨å±€ä»£ç é…è‰²ä¸»é¢˜</span>
              <button class="close-btn" (click)="closeThemeSelector()">âœ•</button>
            </div>
            <div class="theme-options">
              <button 
                *ngFor="let theme of [                
                  { value: 'github', name: 'GitHub', category: 'light' },
                  { value: 'vs2015', name: 'VS Code Dark', category: 'dark' },
                  { value: 'monokai', name: 'Monokai', category: 'dark' },
                  { value: 'solarized-dark', name: 'Solarized Dark', category: 'dark' },
                  { value: 'solarized-light', name: 'Solarized Light', category: 'light' },
                  { value: 'atom-one-dark', name: 'Atom One Dark', category: 'dark' },
                  { value: 'atom-one-light', name: 'Atom One Light', category: 'light' },
                  { value: 'dracula', name: 'Dracula', category: 'dark' },
                  { value: 'nord', name: 'Nord', category: 'dark' },
                  { value: 'tomorrow-night', name: 'Tomorrow Night', category: 'dark' }
                ]" 
                class="theme-option"
                [class.selected]="theme.value === currentCodeTheme"
                (click)="selectGlobalTheme(theme.value)"
                [title]="theme.name + ' (' + theme.category + ')'">
                <span class="theme-preview" [attr.data-theme]="theme.value"></span>
                <span class="theme-name">{{theme.name}}</span>
                <span class="theme-category" [class.dark]="theme.category === 'dark'">{{theme.category}}</span>
              </button>
            </div>
          </div>
        </div>
        
        <button class="toolbar-btn" [class.active]="isNotionMode" title="Notionå¼ç¼–è¾‘" (click)="toggleNotionMode()">
          âœï¸
          <span class="btn-text">Notion</span>
        </button>
        <button class="toolbar-btn" [class.active]="isFullscreen" title="å…¨å±æ¨¡å¼ (F11)" (click)="toggleFullscreen()">
          â›¶
          <span class="btn-text">å…¨å±</span>
        </button>
        <button class="toolbar-btn" [class.active]="isPreviewMode" title="åˆ‡æ¢é¢„è§ˆæ¨¡å¼" (click)="togglePreviewMode()">
          ğŸ‘ï¸
          <span class="btn-text">é¢„è§ˆ</span>
        </button>
        <button class="toolbar-btn" [class.active]="scrollSyncEnabled" title="åŒæ­¥æ»šåŠ¨" (click)="toggleScrollSync()">
          ğŸ”„
          <span class="btn-text">åŒæ­¥</span>
        </button>
      </div>

      <div class="toolbar-group">
        <!-- å­—ä½“å¤§å°æ§åˆ¶ -->
        <button class="toolbar-btn" title="å‡å°å­—ä½“ (Ctrl+-)" (click)="decreaseFontSize()">
          ğŸ”-
          <span class="btn-text">ç¼©å°</span>
        </button>
        <button class="toolbar-btn" title="é‡ç½®å­—ä½“å¤§å° (Ctrl+0)" (click)="resetFontSize()">
          ğŸ”„
          <span class="btn-text">é‡ç½®</span>
        </button>
        <button class="toolbar-btn" title="å¢å¤§å­—ä½“ (Ctrl+=)" (click)="increaseFontSize()">
          ğŸ”+
          <span class="btn-text">æ”¾å¤§</span>
        </button>
      </div>
    </div>

    <!-- ç¼–è¾‘å™¨ä¸»ä½“ -->
    <div class="editor-container" [class.notion-mode]="isNotionMode">
      <!-- ä¼ ç»Ÿç¼–è¾‘åŒºåŸŸ -->
      <div class="editor-panel" [class.hidden]="isPreviewMode || isNotionMode">
        <textarea
          #editor
          class="editor-textarea"
          [(ngModel)]="markdownContent"
          (input)="onContentChange()"
          (compositionupdate)="onContentChange()"
          (compositionend)="onContentChange()"
          placeholder="å¼€å§‹ç¼–å†™æ‚¨çš„ Markdown æ–‡æ¡£...

ğŸ¯ å¿«æ·é”®æç¤ºï¼š
â€¢ Ctrl+B: ç²—ä½“
â€¢ Ctrl+I: æ–œä½“
â€¢ Ctrl+S: ä¿å­˜
â€¢ Ctrl+O: æ‰“å¼€æ–‡ä»¶
â€¢ F11: å…¨å±æ¨¡å¼

ğŸ“¸ æ”¯æŒæ‹–æ‹½å›¾ç‰‡ä¸Šä¼ ï¼
ğŸ“Š æ”¯æŒ Mermaid å›¾è¡¨æ¸²æŸ“">
        </textarea>

        <!-- æ–‡ä»¶è¾“å…¥ï¼ˆéšè—ï¼‰ -->
        <input
          #fileInput
          type="file"
          accept=".md,.markdown,image/*"
          (change)="onFileSelected($event)"
          style="display: none;">
      </div>

      <!-- Notionå¼å®æ—¶ç¼–è¾‘åŒºåŸŸ -->
      <div class="notion-editor" [class.hidden]="!isNotionMode">
        <div
          #notionEditor
          class="notion-content"
          contenteditable="true"
          (input)="onNotionContentChange($event)"
          (keydown)="onNotionKeydown($event)"
          (paste)="onNotionPaste($event)"
          [innerHTML]="notionHtml"
          placeholder="è¾“å…¥ '/' æ˜¾ç¤ºå‘½ä»¤èœå•ï¼Œæˆ–ç›´æ¥è¾“å…¥ Markdown è¯­æ³•...">
        </div>
      </div>

      <!-- é¢„è§ˆåŒºåŸŸ -->
      <div class="preview-panel" [class.full-width]="isPreviewMode" [class.hidden]="isNotionMode">
        <div
          #preview
          class="preview-content"
          [innerHTML]="renderedHtml">
        </div>
      </div>
    </div>

    <!-- çŠ¶æ€æ  -->
    <div class="status-bar">
      <div class="status-left">
        <span class="status-item">ğŸ“ Markdown ç¼–è¾‘å™¨</span>
        <span class="status-item">{{ isDarkTheme ? 'ğŸŒ™ æ·±è‰²' : 'â˜€ï¸ æµ…è‰²' }}</span>
      </div>

      <div class="status-right">
        <span class="status-item">{{ markdownContent.split('\n').length }} è¡Œ</span>
        <span class="status-item">{{ markdownContent.length }} å­—ç¬¦</span>
        <span class="status-item">{{ getWordCount() }} è¯</span>
      </div>
    </div>

    <!-- å¿«æ·é”®å¸®åŠ©ï¼ˆæ‚¬æµ®ï¼‰ -->
    <div class="help-overlay" [class.show]="false">
      <div class="help-content">
        <h3>ğŸš€ å¿«æ·é”®</h3>
        <div class="shortcut-list">
          <div class="shortcut-item">
            <kbd>Ctrl</kbd> + <kbd>B</kbd>
            <span>ç²—ä½“</span>
          </div>
          <div class="shortcut-item">
            <kbd>Ctrl</kbd> + <kbd>I</kbd>
            <span>æ–œä½“</span>
          </div>
          <div class="shortcut-item">
            <kbd>Ctrl</kbd> + <kbd>S</kbd>
            <span>ä¿å­˜</span>
          </div>
          <div class="shortcut-item">
            <kbd>Ctrl</kbd> + <kbd>O</kbd>
            <span>æ‰“å¼€</span>
          </div>
          <div class="shortcut-item">
            <kbd>F11</kbd>
            <span>å…¨å±</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
