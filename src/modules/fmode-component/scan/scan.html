<!-- 初始状态：显示扫描图标 -->
<div class="scan-icon-container" *ngIf="!isScanning">
  <ion-icon
    name="scan-circle-outline"
    class="scan-icon"
    (click)="startScan()"
  ></ion-icon>
</div>

<!-- 扫描状态：全屏扫描界面 -->
<div *ngIf="isScanning" class="scanner-container fullscreen">
  <!-- 顶部返回按钮 -->
  <div class="back-button-container">
    <ion-icon
      name="chevron-back-outline"
      class="back-icon"
      (click)="stopScan()"
    ></ion-icon>
  </div>

  <!-- 扫描遮罩层 -->
  <div class="scan-overlay">
    <!-- 中央扫描框 -->
    <div class="scan-frame">
      <!-- 扫描边框 -->
      <div class="scan-border" *ngIf="isCameraReady"></div>
      <!-- 扫描线 -->
      <div class="scan-line" *ngIf="isCameraReady"></div>
      <!-- 扫描提示文字 -->
      <div class="scan-text" [class.hidden]="!isCameraReady">请将二维码放入框内</div>

      <!-- 摄像头加载指示器 -->
      <div class="loading-indicator" *ngIf="!isCameraReady">
        <ion-spinner name="crescent"></ion-spinner>
        <div class="loading-text">正在启动摄像头...</div>
      </div>
    </div>
  </div>

  <!-- 扫描器组件 -->
  <zxing-scanner
    style="width: 100vw;height: 100vh;object-fit: cover;"
    #scanner
    [enable]="isScanning"
    [formats]="allowedFormats"
    (scanSuccess)="handleScanSuccess($event)"
    (scanError)="handleScanError($event)"
    (camerasFound)="handleCameraFound($event)"
    (camerasNotFound)="handleCameraNotFound()"
  ></zxing-scanner>
</div>
